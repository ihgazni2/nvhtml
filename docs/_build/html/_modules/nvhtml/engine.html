
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>nvhtml.engine &#8212; nvhtml 0.5 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for nvhtml.engine</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">lxml</span>
<span class="kn">import</span> <span class="nn">lxml.sax</span>
<span class="kn">import</span> <span class="nn">lxml.etree</span> <span class="k">as</span> <span class="nn">lxe</span>
<span class="kn">import</span> <span class="nn">elist.elist</span> <span class="k">as</span> <span class="nn">elel</span>
<span class="kn">from</span> <span class="nn">xml.sax.handler</span> <span class="k">import</span> <span class="n">ContentHandler</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">nvhtml</span> <span class="k">import</span> <span class="n">utils</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Toolset for lxml</span>

<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        from lxml.etree import HTML as LXHTML</span>
<span class="sd">        from lxml.etree import XML as LXML</span>
<span class="sd">        from nvhtml import txt</span>
<span class="sd">        from nvhtml import lvsrch</span>
<span class="sd">        from nvhtml import fs</span>
<span class="sd">        from nvhtml import engine</span>
<span class="sd">        from xdict.jprint import pdir,pobj</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">&#39;&#39;&#39;</span>

<div class="viewcode-block" id="pathlist"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.pathlist">[docs]</a><span class="k">def</span> <span class="nf">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get a list of tags ,the tags-path  of a lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list: </span>
<span class="sd">            list-of-tags</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            node = engine.xpath_levels(root,&quot;//a&quot;,5,6)[0]</span>
<span class="sd">            pl = engine.pathlist(node)</span>
<span class="sd">            pl</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="p">[</span><span class="n">each</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">iterancestors</span><span class="p">()]</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span></div>

<div class="viewcode-block" id="between_levels_cond_func"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.between_levels_cond_func">[docs]</a><span class="k">def</span> <span class="nf">between_levels_cond_func</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | To check if the pathlist-lngth of  a lxml.etree._Element is between start and end</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element ele: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  int start: </span>
<span class="sd">            the-start-boundary(include)</span>
<span class="sd">        :param  int end: </span>
<span class="sd">            the-end-boundary(not include)\n</span>
<span class="sd">        :return bool: </span>
<span class="sd">            if lngth-of-pl in range(start,end), return True,\n</span>
<span class="sd">            else return False</span>
<span class="sd">            </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            engine.pathlist(node)</span>
<span class="sd">            engine.between_levels_cond_func(node, 3, 6)</span>
<span class="sd">            engine.between_levels_cond_func(node, 7, 9)</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">((</span><span class="n">lv</span><span class="o">&gt;=</span><span class="n">start</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lv</span><span class="o">&lt;</span><span class="n">end</span><span class="p">))</span></div>

<div class="viewcode-block" id="xpath"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.xpath">[docs]</a><span class="k">def</span> <span class="nf">xpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Use xpath to get lxml.etree._Elements </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-root-element</span>
<span class="sd">        :param  str xp: </span>
<span class="sd">            xpath-string</span>
<span class="sd">        :param \*args:</span>
<span class="sd">            list-of-index</span>
<span class="sd">        :return list-or-tuple-or-lxml.etree._Element:</span>
<span class="sd">            if the lngth of args == 0, return list-of-all-elements\n</span>
<span class="sd">            elif the lngth of args == 1, return lxml.etree._Element\n</span>
<span class="sd">            else return tuple-of-selected-lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            eles = engine.xpath(root,&quot;//a&quot;)</span>
<span class="sd">            ele =  engine.xpath(root,&quot;//a&quot;,0)</span>
<span class="sd">            ele1,ele2,ele3 = engine.xpath(root,&quot;//a&quot;,1,2,3)</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xp</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">all</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">elel</span><span class="o">.</span><span class="n">select_seqs</span><span class="p">(</span><span class="nb">all</span><span class="p">,</span><span class="n">args</span><span class="p">)))</span></div>

<div class="viewcode-block" id="xpath_levels"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.xpath_levels">[docs]</a><span class="k">def</span> <span class="nf">xpath_levels</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Use xpath to get lxml.etree._Elements, whose depth between range(start,end)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-root-element</span>
<span class="sd">        :param  str xp: </span>
<span class="sd">            xpath-string</span>
<span class="sd">        :param \*args:</span>
<span class="sd">            refer to exampls below</span>
<span class="sd">        :param \*\*kwargs:</span>
<span class="sd">            refer to exampls below</span>
<span class="sd">        :return list:</span>
<span class="sd">            list-of-lxml.etree._Element</span>

<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            #eles = engine.xpath_levels(root,&quot;//a&quot;,start,end)</span>
<span class="sd">            eles = engine.xpath_levels(root,&quot;//a&quot;,5,6)</span>
<span class="sd">            #eles = engine.xpath_levels(root,&quot;//a&quot;,start)</span>
<span class="sd">            eles = engine.xpath_levels(root,&quot;//a&quot;,5)</span>
<span class="sd">            #eles = engine.xpath_levels(root,&quot;//a&quot;,start=0,end=ei)</span>
<span class="sd">            eles = engine.xpath_levels(root,&quot;//a&quot;,end=8)</span>
<span class="sd">            #eles = engine.xpath_levels(root,&quot;//a&quot;,start=7,end=last)</span>
<span class="sd">            eles = engine.xpath_levels(root,&quot;//a&quot;,start=7)</span>
<span class="sd">            #eles = engine.xpath_levels(root,&quot;//a&quot;,start=si,end=ei)</span>
<span class="sd">            eles = engine.xpath_levels(root,&quot;//a&quot;,start=7,end=9)</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_levels</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xp</span><span class="p">)</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_select_values_all</span><span class="p">(</span><span class="nb">all</span><span class="p">,</span><span class="n">cond_func</span> <span class="o">=</span> <span class="n">between_levels_cond_func</span><span class="p">,</span><span class="n">cond_func_args</span><span class="o">=</span><span class="p">[</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span></div>

<div class="viewcode-block" id="plget"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.plget">[docs]</a><span class="k">def</span> <span class="nf">plget</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get lxml.etree._Elements using pathlist</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-root-element</span>
<span class="sd">        :param \*args:</span>
<span class="sd">            refer to exampls below</span>
<span class="sd">        :param \*\*kwargs:</span>
<span class="sd">            refer to exampls below</span>
<span class="sd">        :return list:</span>
<span class="sd">            tuple-of-lxml.etree._Elements</span>
<span class="sd">            or list-of-lxml.etree._Elements</span>
<span class="sd">            or lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            engine.plget(root,&quot;a&quot;)</span>
<span class="sd">            #()</span>
<span class="sd">            engine.plget(root,&quot;a&quot;,strict=False)</span>
<span class="sd">            engine.plget(root,[&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;])</span>
<span class="sd">            engine.plget(root,&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;)</span>
<span class="sd">            #[&lt;Element div at 0x21602c68dc8&gt;, &lt;Element div at 0x21602a9f748&gt;, &lt;Element div at 0x21602c68e48&gt;, &lt;Element div at 0x21602c68f48&gt;, &lt;Element div at 0x21602c68ec8&gt;, &lt;Element div at 0x21602c68f08&gt;]</span>
<span class="sd">            engine.plget(root,&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;,whiches=[2,3,4])</span>
<span class="sd">            #(&lt;Element div at 0x21602c68e48&gt;, &lt;Element div at 0x21602c68f48&gt;, &lt;Element div at 0x21602c68ec8&gt;)</span>
<span class="sd">            engine.plget(root,&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;,whiches=3)</span>
<span class="sd">            #&lt;Element div at 0x21602c68f48&gt;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span><span class="s2">&quot;strict&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">strict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">)):</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strict</span><span class="p">):</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">xp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="n">xp</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;whiches&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">whiches</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;whiches&#39;</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">whiches</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">whiches</span> <span class="o">=</span><span class="p">[</span><span class="n">whiches</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">whiches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">xpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="o">*</span><span class="n">whiches</span><span class="p">))</span></div>

<div class="viewcode-block" id="source"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.source">[docs]</a><span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">codec</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the source-txt  of a lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  str codec: </span>
<span class="sd">            by default,codec=&#39;utf-8&#39;</span>
<span class="sd">        :return str: </span>
<span class="sd">            source-txt of lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele1,ele2,ele3 = engine.xpath(root,&quot;//a&quot;,1,2,3)</span>
<span class="sd">            print(engine.source(ele1))</span>
<span class="sd">            print(engine.source(ele2))</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="n">lxe</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">codec</span><span class="p">)</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span></div>

<div class="viewcode-block" id="txtize"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.txtize">[docs]</a><span class="k">def</span> <span class="nf">txtize</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Return a list of source-txts of lxml.etree._Elements</span>
<span class="sd">    </span>
<span class="sd">        :param  lxml.etree._Element nodes: </span>
<span class="sd">            a list of lxml-etree-elements</span>
<span class="sd">        :return str: </span>
<span class="sd">            a list of source-txts of lxml.etree._Elements</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            from nvhtml import utils</span>
<span class="sd">            eles = list(engine.xpath(root,&quot;//a&quot;,1,2,3))</span>
<span class="sd">            txts = engine.txtize(eles)</span>
<span class="sd">            utils.parr(txts)</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">txts</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">source</span><span class="p">,[])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">txts</span><span class="p">)</span></div>

<div class="viewcode-block" id="text_intag"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.text_intag">[docs]</a><span class="k">def</span> <span class="nf">text_intag</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the source-txt  between start-tag and end-tag,</span>
<span class="sd">        | but not include descedants text(NOT itertext),</span>
<span class="sd">        | node.text + each son.tail</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return str: </span>
<span class="sd">            text-intag</span>
<span class="sd">            see the examples below</span>
<span class="sd">            </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str =  &quot;&quot;&quot;&lt;div&gt;</span>
<span class="sd">                div-text</span>
<span class="sd">                &lt;p&gt;</span>
<span class="sd">                    p-text</span>
<span class="sd">                &lt;/p&gt;</span>
<span class="sd">                p-tail-in-div-closure</span>
<span class="sd">            &lt;/div&gt;&quot;&quot;&quot;</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//div&quot;,0)</span>
<span class="sd">            print(engine.text_intag(ele))</span>
<span class="sd">            #&gt;&gt;&gt; print(engine.text_intag(ele))</span>
<span class="sd">            #</span>
<span class="sd">            #    div-text</span>
<span class="sd">            #</span>
<span class="sd">            #    p-tail-in-div-closure</span>
<span class="sd">            #</span>
<span class="sd">            #&gt;&gt;&gt;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">txts</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;./text()&quot;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txts</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_leaf"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.is_leaf">[docs]</a><span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Is leaf-node or not(have children)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return bool: </span>
<span class="sd">            if leaf, return True</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">eles</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">eles</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span></div>

<div class="viewcode-block" id="parent"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.parent">[docs]</a><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get parent-node</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            parent-node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">())</span></div>

<div class="viewcode-block" id="grand_parent"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.grand_parent">[docs]</a><span class="k">def</span> <span class="nf">grand_parent</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get grand-parent-node</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            grand-parent-node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">getparent</span><span class="p">())</span></div>

<div class="viewcode-block" id="ancestor"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.ancestor">[docs]</a><span class="k">def</span> <span class="nf">ancestor</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">which</span><span class="p">,</span><span class="n">pl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get ancestor</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  int which: </span>
<span class="sd">            which ancestor, parent 1,grand_parent 2.....</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            ancestor-node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pl</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">which</span> <span class="o">&gt;</span> <span class="n">lngth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">which</span> <span class="o">=</span> <span class="n">lngth</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">which</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">which</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">while</span><span class="p">(</span><span class="n">which</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="n">which</span> <span class="o">=</span> <span class="n">which</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="ancestors"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.ancestors">[docs]</a><span class="k">def</span> <span class="nf">ancestors</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get ancestor</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  \*args: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :param  \*\*kwargs: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :return list: </span>
<span class="sd">            ancestor-nodes</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//a&quot;,0)</span>
<span class="sd">            eles = engine.ancestors(ele)</span>
<span class="sd">            # [&lt;Element div at 0x21ec4c5d108&gt;, &lt;Element div at 0x21ec4c5d208&gt;, &lt;Element body at 0x21ec4c5d188&gt;, &lt;Element html at 0x21ec4ebe8c8&gt;]</span>
<span class="sd">            eles = engine.ancestor(ele,1)</span>
<span class="sd">            # &lt;Element div at 0x21ec4c5d108&gt;</span>
<span class="sd">            eles = engine.ancestors(ele,2,3)</span>
<span class="sd">            # [&lt;Element div at 0x21ec4c5d208&gt;, &lt;Element body at 0x21ec4c5d188&gt;]</span>
<span class="sd">            eles = engine.ancestors(ele,start=2)</span>
<span class="sd">            # [&lt;Element div at 0x21ec4c5d208&gt;, &lt;Element body at 0x21ec4c5d188&gt;, &lt;Element html at 0x21ec4ebe8c8&gt;]</span>
<span class="sd">            eles = engine.ancestors(ele,end=2)</span>
<span class="sd">            # [&lt;Element div at 0x21ec4c5d108&gt;]</span>
<span class="sd">            eles = engine.ancestors(ele,start=2,end=4)</span>
<span class="sd">            # [&lt;Element div at 0x21ec4c5d208&gt;, &lt;Element body at 0x21ec4c5d188&gt;]</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">map_func</span><span class="p">(</span><span class="n">which</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">pl</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">ancestor</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">which</span><span class="p">,</span><span class="n">pl</span><span class="p">))</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;start&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">whiches</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_whiches</span><span class="p">(</span><span class="n">lngth</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">whiches</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_remove_all</span><span class="p">(</span><span class="n">whiches</span><span class="p">,</span> <span class="n">cond_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ele</span><span class="p">:(</span><span class="n">ele</span><span class="o">&gt;</span><span class="n">lngth</span><span class="p">))</span>
    <span class="n">ances</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">whiches</span><span class="p">,</span><span class="n">map_func</span><span class="p">,[</span><span class="n">node</span><span class="p">,</span><span class="n">pl</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ances</span><span class="p">)</span></div>

<div class="viewcode-block" id="children"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.children">[docs]</a><span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get children</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  \*args: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :param  \*\*kwargs: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :return list: </span>
<span class="sd">            list-of-child-nodes</span>
<span class="sd">        </span>
<span class="sd">        ::</span>

<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//div&quot;,0)</span>
<span class="sd">            childs = engine.children(ele)</span>
<span class="sd">            childs</span>
<span class="sd">            # [&lt;Element div at 0x1a8609755c8&gt;, &lt;Element div at 0x1a860973988&gt;, &lt;Element div at 0x1a860973b48&gt;, &lt;Element div at 0x1a860973a88&gt;, &lt;!-- maincontent end --&gt;, &lt;Element div at 0x1a860973b08&gt;, &lt;Element div at 0x1a860973908&gt;]</span>
<span class="sd">            engine.children(ele,0)</span>
<span class="sd">            # [&lt;Element div at 0x1a8609755c8&gt;]</span>
<span class="sd">            engine.children(ele,4)</span>
<span class="sd">            # [&lt;!-- maincontent end --&gt;]</span>
<span class="sd">            engine.children(ele,6)</span>
<span class="sd">            # [&lt;Element div at 0x1a860973908&gt;]</span>
<span class="sd">            engine.children(ele,1,3,5)</span>
<span class="sd">            # [&lt;Element div at 0x1a860973988&gt;, &lt;Element div at 0x1a860973a88&gt;, &lt;Element div at 0x1a860973b08&gt;]</span>
<span class="sd">            engine.children(ele,[1,3,5])</span>
<span class="sd">            # [&lt;Element div at 0x1a860973988&gt;, &lt;Element div at 0x1a860973a88&gt;, &lt;Element div at 0x1a860973b08&gt;]</span>
<span class="sd">            engine.children(ele,start=1,end=4)</span>
<span class="sd">            # [&lt;Element div at 0x1a860973988&gt;, &lt;Element div at 0x1a860973b48&gt;, &lt;Element div at 0x1a860973a88&gt;]</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">childs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">childs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="n">whiches</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_whiches</span><span class="p">(</span><span class="n">lngth</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">whiches</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_remove_all</span><span class="p">(</span><span class="n">whiches</span><span class="p">,</span> <span class="n">cond_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ele</span><span class="p">:(</span><span class="n">ele</span><span class="o">&gt;</span><span class="n">lngth</span><span class="p">))</span>
    <span class="n">childs</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">select_seqs</span><span class="p">(</span><span class="n">childs</span><span class="p">,</span><span class="n">whiches</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">childs</span><span class="p">)</span></div>

<div class="viewcode-block" id="child"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.child">[docs]</a><span class="k">def</span> <span class="nf">child</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">which</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get child</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  int which: </span>
<span class="sd">            which child</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            child-node</span>
<span class="sd">        </span>
<span class="sd">        ::</span>

<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//div&quot;,0)</span>
<span class="sd">            engine.child(ele,2)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">chld</span> <span class="o">=</span> <span class="n">children</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">which</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">chld</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span><span class="p">(</span><span class="n">chld</span><span class="p">)</span></div>

<div class="viewcode-block" id="sibseq"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.sibseq">[docs]</a><span class="k">def</span> <span class="nf">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the sequence-number of siblings(share the same parent)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return int: </span>
<span class="sd">            the sequence-number of siblings</span>
<span class="sd">        </span>
<span class="sd">        ::</span>

<span class="sd">            html_str = &quot;&quot;&quot;</span>
<span class="sd">            &lt;html&gt;</span>
<span class="sd">                &lt;head&gt;</span>
<span class="sd">                &lt;/head&gt;</span>
<span class="sd">                &lt;body&gt;</span>
<span class="sd">                    &lt;div-out-1&gt;</span>
<span class="sd">                        &lt;div id=&quot;0&quot;&gt;b0&lt;/div&gt;</span>
<span class="sd">                        &lt;div id=&quot;1&quot;&gt;b1&lt;/div&gt;</span>
<span class="sd">                        &lt;div id=&quot;2&quot;&gt;b2&lt;/div&gt;</span>
<span class="sd">                        &lt;div id=&quot;3&quot;&gt;b3&lt;/div&gt;</span>
<span class="sd">                    &lt;/div-out-1&gt;</span>
<span class="sd">                    &lt;div-out-2&gt;</span>
<span class="sd">                        &lt;li id=&quot;0&quot;&gt;l0&lt;/li&gt;</span>
<span class="sd">                        &lt;li id=&quot;1&quot;&gt;l1&lt;/li&gt;</span>
<span class="sd">                        &lt;li id=&quot;2&quot;&gt;l2&lt;/li&gt;</span>
<span class="sd">                        &lt;li id=&quot;3&quot;&gt;l3&lt;/li&gt;</span>
<span class="sd">                    &lt;/div-out-2&gt;</span>
<span class="sd">                &lt;/body&gt;</span>
<span class="sd">            &lt;/html&gt;</span>
<span class="sd">            &quot;&quot;&quot;</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/div&quot;,2)</span>
<span class="sd">            ele.text</span>
<span class="sd">            # &#39;b2&#39;</span>
<span class="sd">            engine.sibseq(ele)</span>
<span class="sd">            # 2</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">childs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">childs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">total</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">childs</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">curr_seq</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">return</span><span class="p">(</span><span class="n">curr_seq</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="siblings"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.siblings">[docs]</a><span class="k">def</span> <span class="nf">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get siblings(share the same parent)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  \*args: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :param  \*\*kwargs: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :return list: </span>
<span class="sd">            list-of-sibling-nodes</span>
<span class="sd">        </span>
<span class="sd">        ::</span>

<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/div&quot;,2)</span>
<span class="sd">            sibs = engine.siblings(ele)</span>
<span class="sd">            sibs</span>
<span class="sd">            #[&lt;Element div at 0x1d3f56f2808&gt;, &lt;Element div at 0x1d3f56f2848&gt;, &lt;Element div at 0x1d3f56f0308&gt;, &lt;Element div at 0x1d3f56f2888&gt;]</span>
<span class="sd">            engine.siblings(ele,0)</span>
<span class="sd">            #[&lt;Element div at 0x1d3f56f2808&gt;]</span>
<span class="sd">            engine.siblings(ele,3)</span>
<span class="sd">            #[&lt;Element div at 0x1d3f56f2888&gt;]</span>
<span class="sd">            engine.siblings(ele,1,2)</span>
<span class="sd">            #[&lt;Element div at 0x1d3f56f2848&gt;, &lt;Element div at 0x1d3f56f0308&gt;]</span>
<span class="sd">            engine.siblings(ele,[1,2,3])</span>
<span class="sd">            #[&lt;Element div at 0x1d3f56f2848&gt;, &lt;Element div at 0x1d3f56f0308&gt;, &lt;Element div at 0x1d3f56f2888&gt;]</span>
<span class="sd">            engine.siblings(ele,start=2,end=3)</span>
<span class="sd">            #[&lt;Element div at 0x1d3f56f0308&gt;]</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">childs</span> <span class="o">=</span> <span class="n">children</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">childs</span><span class="p">)</span></div>

<div class="viewcode-block" id="samepl_siblings"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.samepl_siblings">[docs]</a><span class="k">def</span> <span class="nf">samepl_siblings</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get siblings(share the same parent) which have the same pathlist </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list: </span>
<span class="sd">            list-of-child-nodes</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = &quot;&quot;&quot;</span>
<span class="sd">            &lt;html&gt;</span>
<span class="sd">                &lt;head&gt;</span>
<span class="sd">                &lt;/head&gt;</span>
<span class="sd">                &lt;body&gt;</span>
<span class="sd">                    &lt;div-out-1&gt;</span>
<span class="sd">                        &lt;divx id=&quot;0&quot;&gt;b0&lt;/divx&gt;</span>
<span class="sd">                        &lt;divy id=&quot;1&quot;&gt;b1&lt;/divy&gt;</span>
<span class="sd">                        &lt;divx id=&quot;2&quot;&gt;b2&lt;/divx&gt;</span>
<span class="sd">                        &lt;divy id=&quot;3&quot;&gt;b3&lt;/divy&gt;</span>
<span class="sd">                    &lt;/div-out-1&gt;</span>
<span class="sd">                    &lt;div-out-2&gt;</span>
<span class="sd">                        &lt;li id=&quot;0&quot;&gt;l0&lt;/li&gt;</span>
<span class="sd">                        &lt;li id=&quot;1&quot;&gt;l1&lt;/li&gt;</span>
<span class="sd">                        &lt;li id=&quot;2&quot;&gt;l2&lt;/li&gt;</span>
<span class="sd">                        &lt;li id=&quot;3&quot;&gt;l3&lt;/li&gt;</span>
<span class="sd">                    &lt;/div-out-2&gt;</span>
<span class="sd">                &lt;/body&gt;</span>
<span class="sd">            &lt;/html&gt;</span>
<span class="sd">            &quot;&quot;&quot;</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divx&quot;,0)</span>
<span class="sd">            eles = engine.samepl_siblings(ele)</span>
<span class="sd">            eles</span>
<span class="sd">            # [&lt;Element divx at 0x251425b9cc8&gt;, &lt;Element divx at 0x251425bf888&gt;]</span>
<span class="sd">            engine.pathlist(eles[0])</span>
<span class="sd">            # engine.pathlist(eles[0])</span>
<span class="sd">            engine.pathlist(eles[1])</span>
<span class="sd">            # engine.pathlist(eles[1])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_select_values_all</span><span class="p">(</span><span class="n">sibs</span><span class="p">,</span><span class="n">cond_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">:(</span><span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="n">pl</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sibs</span><span class="p">)</span></div>

<div class="viewcode-block" id="samepl_sibseq"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.samepl_sibseq">[docs]</a><span class="k">def</span> <span class="nf">samepl_sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the sequence-number of siblings which have the same pathlist </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return int: </span>
<span class="sd">            the sequence-number of siblings which have the same pathlist </span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divx&quot;,1)</span>
<span class="sd">            engine.sibseq(ele)</span>
<span class="sd">            # 2</span>
<span class="sd">            engine.samepl_sibseq(ele)</span>
<span class="sd">            # 1</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">childs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">childs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">total</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">pathlist</span><span class="p">(</span><span class="n">childs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">pl</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span><span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">childs</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="lsib"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.lsib">[docs]</a><span class="k">def</span> <span class="nf">lsib</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the left sibling </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            left-sibling</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divx&quot;,1)</span>
<span class="sd">            engine.lsib(ele)</span>
<span class="sd">            # &lt;divy id=&quot;1&quot;&gt;b1&lt;/divy&gt;</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divx&quot;,0)</span>
<span class="sd">            # &lt;divx id=&quot;0&quot;&gt;b0&lt;/divx&gt;</span>
<span class="sd">            engine.lsib(ele)</span>
<span class="sd">            # None beacuse  &lt;divx id=&quot;0&quot;&gt;b0&lt;/divx&gt;  is the left-most child of &lt;div-out-1&gt;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">sibs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="n">lseq</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lseq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">lseq</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lngth</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">sibs</span><span class="p">[</span><span class="n">lseq</span><span class="p">])</span></div>

<div class="viewcode-block" id="rsib"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.rsib">[docs]</a><span class="k">def</span> <span class="nf">rsib</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the right sibling </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            right-sibling</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divy&quot;,1)</span>
<span class="sd">            # &lt;divy id=&quot;3&quot;&gt;b3&lt;/divy&gt;</span>
<span class="sd">            engine.rsib(ele)</span>
<span class="sd">            # None beacuse  &lt;divy id=&quot;3&quot;&gt;b3&lt;/divy&gt;  is the right-most child of &lt;div-out-1&gt;</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divy&quot;,0)</span>
<span class="sd">            # &lt;divy id=&quot;1&quot;&gt;b1&lt;/divy&gt;</span>
<span class="sd">            print(engine.source(engine.rsib(ele)))</span>
<span class="sd">            # &lt;divx id=&quot;2&quot;&gt;b2&lt;/divx&gt;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">sibs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="n">rseq</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rseq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">rseq</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lngth</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">sibs</span><span class="p">[</span><span class="n">rseq</span><span class="p">])</span></div>

<div class="viewcode-block" id="preceding_sibs"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.preceding_sibs">[docs]</a><span class="k">def</span> <span class="nf">preceding_sibs</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the left-side siblings </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list: </span>
<span class="sd">            siblings-before-node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">curr_seq</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sibs</span><span class="p">[:</span><span class="n">curr_seq</span><span class="p">])</span></div>

<div class="viewcode-block" id="following_sibs"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.following_sibs">[docs]</a><span class="k">def</span> <span class="nf">following_sibs</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the right-side siblings </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list: </span>
<span class="sd">            siblings-after-node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">curr_seq</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sibs</span><span class="p">[(</span><span class="n">curr_seq</span><span class="o">+</span><span class="mi">1</span><span class="p">):])</span></div>

<div class="viewcode-block" id="lcin"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.lcin">[docs]</a><span class="k">def</span> <span class="nf">lcin</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the left cousin (adjancent to the left,but have different parent)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            left-cousin</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-2/li&quot;,0)</span>
<span class="sd">            # &lt;li id=&quot;0&quot;&gt;l0&lt;/li&gt;</span>
<span class="sd">            print(engine.source(engine.lcin(ele)))</span>
<span class="sd">            #&lt;divy id=&quot;3&quot;&gt;b3&lt;/divy&gt;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">seq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plsib</span> <span class="o">=</span> <span class="n">lsib</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">plsib</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plsibchilds</span> <span class="o">=</span> <span class="n">children</span><span class="p">(</span><span class="n">plsib</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">plsibchilds</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">plsibchilds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="rcin"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.rcin">[docs]</a><span class="k">def</span> <span class="nf">rcin</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the right cousin (adjancent to the right,but have different parent)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            right-cousin</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divy&quot;,1)</span>
<span class="sd">            # &lt;divy id=&quot;3&quot;&gt;b3&lt;/divy&gt;</span>
<span class="sd">            print(engine.source(engine.rcin(ele)))</span>
<span class="sd">            # &lt;li id=&quot;0&quot;&gt;l0&lt;/li&gt;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">sibs</span> <span class="o">=</span> <span class="n">siblings</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">sibs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">seq</span> <span class="o">==</span> <span class="p">(</span><span class="n">lngth</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prsib</span> <span class="o">=</span> <span class="n">rsib</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">prsib</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prsibchilds</span> <span class="o">=</span> <span class="n">children</span><span class="p">(</span><span class="n">prsib</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">prsibchilds</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">prsibchilds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="rootnode"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.rootnode">[docs]</a><span class="k">def</span> <span class="nf">rootnode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get all the lxml.etree._Elements in the same layer(have the same pathlist lngth)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            root-node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span></div>

<div class="viewcode-block" id="layer"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.layer">[docs]</a><span class="k">def</span> <span class="nf">layer</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get all the lxml.etree._Elements in the same layer(have the same pathlist lngth)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list: </span>
<span class="sd">            the list of lxml.etree._Elements in the same layer</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-1/divy&quot;,1)</span>
<span class="sd">            utils.parr(engine.layer(ele))</span>
<span class="sd">            &lt;Element divx at 0x2a541a5bfc8&gt;</span>
<span class="sd">            &lt;Element divy at 0x2a541a4a1c8&gt;</span>
<span class="sd">            &lt;Element divx at 0x2a541a4a208&gt;</span>
<span class="sd">            &lt;Element divy at 0x2a541a4a248&gt;</span>
<span class="sd">            &lt;Element li at 0x2a541a58848&gt;</span>
<span class="sd">            &lt;Element li at 0x2a541a4a3c8&gt;</span>
<span class="sd">            &lt;Element li at 0x2a541a4a408&gt;</span>
<span class="sd">            &lt;Element li at 0x2a541a4a448&gt;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">rootnode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">lngth</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="n">wfs</span> <span class="o">=</span> <span class="n">WFS</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">handler</span><span class="o">=</span><span class="n">layer_wfs_handler</span><span class="p">,</span><span class="n">until</span><span class="o">=</span><span class="n">lngth</span><span class="p">)</span>
    <span class="n">lyr</span> <span class="o">=</span> <span class="n">wfs</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">lngth</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lyr</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">lyr</span><span class="p">,</span><span class="k">lambda</span> <span class="n">ele</span><span class="p">:</span><span class="n">ele</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">],[])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">lyr</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="depth"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.depth">[docs]</a><span class="k">def</span> <span class="nf">depth</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the depth of lxml.etree._Element(depth = the-lngth-of-pathlist - 1)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return int: </span>
<span class="sd">            the depth of lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="breadth"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.breadth">[docs]</a><span class="k">def</span> <span class="nf">breadth</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the breadth of lxml.etree._Element in the layer</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return int: </span>
<span class="sd">            the breadth of lxml.etree._Element</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-2/li&quot;,0)</span>
<span class="sd">            engine.breadth(ele)</span>
<span class="sd">            #4</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">lyr</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lyr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">node</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="loc"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.loc">[docs]</a><span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the location(breadth,depth) of lxml.etree._Element in the desc-matrix</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return tuple: </span>
<span class="sd">            (breadth,depth)</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-2/li&quot;,0)</span>
<span class="sd">            engine.loc(ele)</span>
<span class="sd">            #(4,3)</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">((</span><span class="n">breadth</span><span class="p">(</span><span class="n">node</span><span class="p">),</span><span class="n">depth</span><span class="p">(</span><span class="n">node</span><span class="p">)))</span></div>

<div class="viewcode-block" id="samepl_breadth"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.samepl_breadth">[docs]</a><span class="k">def</span> <span class="nf">samepl_breadth</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get the sequence-number of lxml.etree._Element in the elements having the same pathlist (whole layer ,NOT just the siblings)</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return int: </span>
<span class="sd">            the breadth in the-whole-same-pathlist-elements</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body/div-out-2/divx&quot;,0)</span>
<span class="sd">            engine.sampl_breadth(ele)</span>
<span class="sd">            # 2</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">lyr</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lyr</span><span class="p">)):</span>
        <span class="n">ele</span> <span class="o">=</span> <span class="n">lyr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ele_pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ele_pl</span> <span class="o">==</span> <span class="n">pl</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span><span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">ele</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="descendants"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.descendants">[docs]</a><span class="k">def</span> <span class="nf">descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get Descendants</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  \*args: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :param  \*\*kwargs: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :return list: </span>
<span class="sd">            list-of-decedants-nodes</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            engine.descendants(root).__len__()</span>
<span class="sd">            # 867</span>
<span class="sd">            engine.descendants(root,1,2)</span>
<span class="sd">            # [&lt;Element head at 0x2ec39e02f08&gt;, &lt;Element body at 0x2ec39e12148&gt;]</span>
<span class="sd">            engine.descendants(root,0,1)</span>
<span class="sd">            # [&lt;Element html at 0x2ec3a126608&gt;]</span>
<span class="sd">            eles = engine.descendants(root,5,7)</span>
<span class="sd">            # start = 5 ,end =7, to get the nodes whose depth between 5 and 7 </span>
<span class="sd">            engine.pathlist(eles[0])</span>
<span class="sd">            # [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;script&#39;]</span>
<span class="sd">            engine.pathlist(eles[100])</span>
<span class="sd">            # [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;ul&#39;, &#39;li&#39;]</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_levels</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">unhandled</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>
    <span class="n">next_unhandled</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span><span class="p">(</span><span class="n">unhandled</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">unhandled</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
            <span class="n">each_node</span> <span class="o">=</span> <span class="n">unhandled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">childs</span> <span class="o">=</span> <span class="n">each_node</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="n">childs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dscdnts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dscdnts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
                <span class="n">next_unhandled</span> <span class="o">=</span> <span class="n">next_unhandled</span> <span class="o">+</span> <span class="n">childs</span>
        <span class="n">unhandled</span> <span class="o">=</span> <span class="n">next_unhandled</span>
        <span class="n">next_unhandled</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_select_values_all</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">cond_func</span> <span class="o">=</span> <span class="n">between_levels_cond_func</span><span class="p">,</span><span class="n">cond_func_args</span><span class="o">=</span><span class="p">[</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">)</span></div>

<span class="c1">#</span>
<div class="viewcode-block" id="extract_pls"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.extract_pls">[docs]</a><span class="k">def</span> <span class="nf">extract_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">rel</span><span class="o">=</span><span class="s2">&quot;False&quot;</span><span class="p">):</span>
    <span class="n">pls</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">pathlist</span><span class="p">,[])</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rel</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">lngth</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
        <span class="n">pls</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">pls</span><span class="p">,</span><span class="k">lambda</span> <span class="n">rslt</span><span class="p">:</span><span class="n">rslt</span><span class="p">[</span><span class="n">lngth</span><span class="p">:],[])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pls</span><span class="p">)</span></div>

<div class="viewcode-block" id="descendants_pls"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.descendants_pls">[docs]</a><span class="k">def</span> <span class="nf">descendants_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get Descendant pathlists</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  \*args: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :param  \*\*kwargs: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :return list: </span>
<span class="sd">            list-of-decedants-pathlists</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body&quot;,0)</span>
<span class="sd">            engine.descendants_pls(ele).__len__()</span>
<span class="sd">            # 852</span>
<span class="sd">            pls = engine.descendants_pls(ele,5,7)</span>
<span class="sd">            # start = 5 ,end =7, to get the nodes whose depth between 5 and 7 </span>
<span class="sd">            pls[0]</span>
<span class="sd">            # [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;script&#39;]</span>
<span class="sd">            pls[100]</span>
<span class="sd">            # [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;ul&#39;, &#39;li&#39;]</span>
<span class="sd">            engine.pathlist(root)</span>
<span class="sd">            # [&#39;html&#39;]</span>
<span class="sd">            engine.pathlist(ele)</span>
<span class="sd">            # [&#39;html&#39;, &#39;body&#39;]</span>
<span class="sd">            pls = engine.descendants_pls(ele,5,7,rel=True)</span>
<span class="sd">            # relative pathlist</span>
<span class="sd">            pls[0]</span>
<span class="sd">            # [&#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;script&#39;]</span>
<span class="sd">            pls[100]</span>
<span class="sd">            # [&#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;ul&#39;, &#39;li&#39;]</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_levels</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">extract_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">rel</span><span class="p">))</span></div>

<div class="viewcode-block" id="leaf_descendants"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.leaf_descendants">[docs]</a><span class="k">def</span> <span class="nf">leaf_descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Same as descendants, but only leaf-decendants</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_select_values_all</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">cond_func</span> <span class="o">=</span> <span class="n">is_leaf</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">)</span></div>

<div class="viewcode-block" id="leaf_descendants_pls"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.leaf_descendants_pls">[docs]</a><span class="k">def</span> <span class="nf">leaf_descendants_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Same as descendants_pls, but only leaf-decendants</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_levels</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">leaf_descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">extract_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">rel</span><span class="p">))</span></div>

<div class="viewcode-block" id="nonleaf_descendants"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.nonleaf_descendants">[docs]</a><span class="k">def</span> <span class="nf">nonleaf_descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Same as descendants, but only nonleaf-decendants</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">cond_select_values_all</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">cond_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span><span class="ow">not</span><span class="p">(</span><span class="n">is_leaf</span><span class="p">(</span><span class="n">node</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">dscdnts</span><span class="p">)</span></div>

<div class="viewcode-block" id="nonleaf_descendants_pls"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.nonleaf_descendants_pls">[docs]</a><span class="k">def</span> <span class="nf">nonleaf_descendants_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Same as descendants_pls, but only nonleaf-decendants</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">arguments_levels</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">dscdnts</span> <span class="o">=</span> <span class="n">nonleaf_descendants</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">extract_pls</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">dscdnts</span><span class="p">,</span><span class="n">rel</span><span class="p">))</span></div>

<div class="viewcode-block" id="disconnect"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.disconnect">[docs]</a><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Disconnect </span>

<span class="sd">        :param  lxml.etree._Element node: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return lxml.etree._Element: </span>
<span class="sd">            the disconnected node</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            # &lt;Element html at 0x2ec3a13ee08&gt;</span>
<span class="sd">            ele = engine.xpath(root,&quot;//body&quot;,0)</span>
<span class="sd">            # &lt;Element body at 0x2ec3a14da08&gt;</span>
<span class="sd">            ele.getparent()</span>
<span class="sd">            # &lt;Element html at 0x2ec3a13ee08&gt;</span>
<span class="sd">            engine.disconnect(ele)</span>
<span class="sd">            # &lt;Element body at 0x2ec3a14da08&gt;</span>
<span class="sd">            ele.getparent()</span>
<span class="sd">            # None</span>
<span class="sd">            root.getchildren()</span>
<span class="sd">            # [&lt;Element head at 0x2ec39e1f5c8&gt;]</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<span class="c1">#dom tree</span>

<div class="viewcode-block" id="layer_wfs_handler"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.layer_wfs_handler">[docs]</a><span class="k">def</span> <span class="nf">layer_wfs_handler</span><span class="p">(</span><span class="n">each_node</span><span class="p">,</span><span class="n">pls</span><span class="p">,</span><span class="n">breadth</span><span class="p">):</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
    <span class="n">which</span> <span class="o">=</span> <span class="n">pls</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
    <span class="n">pls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">each_node</span>
    <span class="k">return</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="default_wfs_handler"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.default_wfs_handler">[docs]</a><span class="k">def</span> <span class="nf">default_wfs_handler</span><span class="p">(</span><span class="n">each_node</span><span class="p">,</span><span class="n">pls</span><span class="p">,</span><span class="n">breadth</span><span class="p">):</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
    <span class="n">which</span> <span class="o">=</span> <span class="n">pls</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
    <span class="n">pls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;samepl_sibseq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samepl_sibseq</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;samepl_breadth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">which</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">each_node</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;sibseq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sibseq</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;attrib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">each_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">each_node</span><span class="o">.</span><span class="n">text</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;tail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">each_node</span><span class="o">.</span><span class="n">tail</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;text_intag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_intag</span><span class="p">(</span><span class="n">each_node</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">each_node</span>
    <span class="k">return</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="init_cls_wfs_arguments"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.init_cls_wfs_arguments">[docs]</a><span class="k">def</span> <span class="nf">init_cls_wfs_arguments</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span><span class="p">(</span><span class="s2">&quot;until&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">until</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">until</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">32</span>
    <span class="k">if</span><span class="p">(</span><span class="s2">&quot;handler&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;handler&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">default_wfs_handler</span>
    <span class="k">if</span><span class="p">(</span><span class="s2">&quot;yield_d&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">yield_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yield_d&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yield_d</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span><span class="p">(</span><span class="s2">&quot;yield_currlv&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">yield_currlv</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yield_currlv&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yield_currlv</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span><span class="p">(</span><span class="s2">&quot;yield_curr_next_unhandled&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">yield_curr_next_unhandled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yield_curr_next_unhandled&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yield_curr_next_unhandled</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span><span class="p">((</span><span class="n">handler</span><span class="p">,</span><span class="n">until</span><span class="p">,</span><span class="n">yield_d</span><span class="p">,</span><span class="n">yield_currlv</span><span class="p">,</span><span class="n">yield_curr_next_unhandled</span><span class="p">))</span></div>


<div class="viewcode-block" id="WFS"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.WFS">[docs]</a><span class="k">class</span> <span class="nc">WFS</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get description-matrix of a lxml.etree._Element root</span>
<span class="sd">          </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  \*args: </span>
<span class="sd">            see examples below</span>
<span class="sd">        :param  function kwargs\[&#39;handler&#39;\]: </span>
<span class="sd">            default:default_wfs_handler(each_node,breadth)</span>
<span class="sd">        :param  int kwargs\[&#39;until&#39;\]: </span>
<span class="sd">            until which-layer(before this layer)</span>
<span class="sd">            default:traverse-all-levels</span>
<span class="sd">        :return obj:</span>
<span class="sd">            see examples below</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            the default_wfs_handler</span>
<span class="sd">                def default_wfs_handler(each_node,pls,breadth):</span>
<span class="sd">                    pl = pathlist(each_node)</span>
<span class="sd">                    which = pls.count(pl)</span>
<span class="sd">                    pls.append(pl)</span>
<span class="sd">                    d = {}</span>
<span class="sd">                    d[&#39;pl&#39;] = pl</span>
<span class="sd">                    d[&#39;samepl_sibseq&#39;] = samepl_sibseq(each_node)</span>
<span class="sd">                    d[&#39;samepl_breadth&#39;] = which</span>
<span class="sd">                    d[&#39;tag&#39;] = str(each_node.tag)</span>
<span class="sd">                    d[&#39;sibseq&#39;] = sibseq(each_node)</span>
<span class="sd">                    d[&#39;attrib&#39;] = dict(each_node.attrib)</span>
<span class="sd">                    d[&#39;text&#39;] = each_node.text</span>
<span class="sd">                    d[&#39;tail&#39;] = each_node.tail</span>
<span class="sd">                    d[&#39;text_intag&#39;] = text_intag(each_node)</span>
<span class="sd">                    d[&#39;node&#39;] = each_node</span>
<span class="sd">                    return(d)</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            wfs = engine.WFS(root)</span>
<span class="sd">            wfs.depth</span>
<span class="sd">            #8</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            pobj(wfs.mat[3][1])</span>
<span class="sd">            </span>
<span class="sd">            {</span>
<span class="sd">             &#39;pl&#39;:</span>
<span class="sd">                   [</span>
<span class="sd">                    &#39;html&#39;,</span>
<span class="sd">                    &#39;body&#39;,</span>
<span class="sd">                    &#39;div&#39;,</span>
<span class="sd">                    &#39;div&#39;</span>
<span class="sd">                   ],</span>
<span class="sd">             &#39;samepl_sibseq&#39;: 1,</span>
<span class="sd">             &#39;samepl_breadth&#39;: 1,</span>
<span class="sd">             &#39;tag&#39;: &#39;div&#39;,</span>
<span class="sd">             &#39;sibseq&#39;: 1,</span>
<span class="sd">             &#39;attrib&#39;:</span>
<span class="sd">                       {</span>
<span class="sd">                        &#39;id&#39;: &#39;navfirst&#39;</span>
<span class="sd">                       },</span>
<span class="sd">             &#39;text&#39;: &#39;\\r\\n&#39;,</span>
<span class="sd">             &#39;tail&#39;: &#39;\\r\\n\\r\\n&#39;,</span>
<span class="sd">             &#39;text_intag&#39;: &#39;\\r\\n\\r\\n&#39;,</span>
<span class="sd">             &#39;node&#39;: &lt;Elementdivat0x24135ef9a88&gt;</span>
<span class="sd">            }</span>
<span class="sd">            </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">handler</span><span class="p">,</span><span class="n">until</span><span class="p">,</span><span class="n">yield_d</span><span class="p">,</span><span class="n">yield_currlv</span><span class="p">,</span><span class="n">yield_curr_next_unhandled</span> <span class="o">=</span> <span class="n">init_cls_wfs_arguments</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">unhandled</span> <span class="o">=</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span>
        <span class="n">next_unhandled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span><span class="p">(</span><span class="n">unhandled</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="o">&lt;</span><span class="n">until</span><span class="p">):</span>
                <span class="c1">########</span>
                <span class="c1">#yield_unhandled and (yield unhandled)</span>
                <span class="c1">########</span>
                <span class="n">curr_level</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_level</span><span class="p">)</span>
                <span class="n">pls</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">unhandled</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
                    <span class="n">each_node</span> <span class="o">=</span> <span class="n">unhandled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">childs</span> <span class="o">=</span> <span class="n">each_node</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">each_node</span><span class="p">,</span><span class="n">pls</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1">######</span>
                    <span class="c1">#yield_d and (yield (d,i))</span>
                    <span class="c1">#######</span>
                    <span class="n">curr_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="c1">#######</span>
                    <span class="c1">#yield_currlv and (yield (curr_level,i))</span>
                    <span class="c1">#######</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">childs</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">next_unhandled</span> <span class="o">=</span> <span class="n">next_unhandled</span> <span class="o">+</span> <span class="n">childs</span>
                    <span class="c1">########</span>
                    <span class="c1">#yield_curr_next_unhandled and (yield (next_unhandled,i))</span>
                    <span class="c1">#######</span>
                <span class="n">unhandled</span> <span class="o">=</span> <span class="n">next_unhandled</span>
                <span class="n">next_unhandled</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span></div>


<div class="viewcode-block" id="wfs_traverse"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.wfs_traverse">[docs]</a><span class="k">def</span> <span class="nf">wfs_traverse</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Same as class WFS ,just return the object(include .mat and .root)</span>
<span class="sd">        | using default_wfs_handler</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rslt</span> <span class="o">=</span> <span class="n">WFS</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span></div>

<div class="viewcode-block" id="wfspls"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.wfspls">[docs]</a><span class="k">def</span> <span class="nf">wfspls</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | pathlist-sequence of  width-first-traverse  </span>
<span class="sd">          </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list:</span>
<span class="sd">            list of pathlists  in width-first-traverse-sequence</span>
<span class="sd">    </span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">        root = LXHTML(html_str)</span>
<span class="sd">        pls = engine.wfspls(root)</span>
<span class="sd">        utils.parr(pls[:10])</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        [&#39;html&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &lt;cyfunction Comment at 0x0000024135C12550&gt;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;script&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;script&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;link&#39;]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        utils.parr(pls[-10:])</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;span&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;table&#39;, &#39;tr&#39;, &#39;td&#39;, &#39;span&#39;]</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">wfs</span> <span class="o">=</span> <span class="n">wfs_traverse</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">wfs</span><span class="o">.</span><span class="n">mat</span>
    <span class="n">pls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
        <span class="n">desc_lyr</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">desc_lyr</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">desc_lyr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">pl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s1">&#39;pl&#39;</span><span class="p">])</span>
            <span class="n">pls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pls</span><span class="p">)</span></div>


<div class="viewcode-block" id="loc2node"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.loc2node">[docs]</a><span class="k">def</span> <span class="nf">loc2node</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get node Via breadth,depth</span>

<span class="sd">        :param  \*args: </span>
<span class="sd">            breadth,depth or (depth,breadth)</span>
<span class="sd">        :return lxml.etree._Element:</span>
<span class="sd">            not at location (depth,breadth)</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            node = engine.loc2node(root,5,6)</span>
<span class="sd">            node</span>
<span class="sd">            # &lt;Element li at 0x1c1502acd48&gt;</span>
<span class="sd">            engine.depth(node)</span>
<span class="sd">            # 5</span>
<span class="sd">            engine.breadth(node)</span>
<span class="sd">            # 6</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">WFS</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">mat</span>
    <span class="k">return</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="s1">&#39;node&#39;</span><span class="p">])</span></div>
    
<span class="c1">#sax</span>

<div class="viewcode-block" id="DFS"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.DFS">[docs]</a><span class="k">class</span> <span class="nc">DFS</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Get sax-style deep-first-traverse  of a lxml.etree._Element root</span>
<span class="sd">          </span>
<span class="sd">        :param  bool kwargs[&#39;attrib_pl&#39;]: </span>
<span class="sd">            return full-info attrib-path-list corresponding to path-list</span>
<span class="sd">        :return obj:</span>
<span class="sd">            return a obj for lxml.sax.saxify</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            if using xml-mode</span>
<span class="sd">                from io import StringIO</span>
<span class="sd">                f = StringIO(s)</span>
<span class="sd">                root = lxe.parse(f)</span>
<span class="sd">            </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            import lxml.sax</span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            dfs = engine.DFS()</span>
<span class="sd">            lxml.sax.saxify(root, dfs)</span>
<span class="sd">            utils.parr(dfs.pls[:5])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            [&#39;html&#39;, &#39;head&#39;, &#39;script&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;head&#39;, &#39;script&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">            utils.parr(dfs.pls[-10:])</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;script&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;, &#39;a&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;]</span>
<span class="sd">            [&#39;html&#39;, &#39;body&#39;]</span>
<span class="sd">            [&#39;html&#39;]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            utils.parr(dfs.datas[-5:])</span>
<span class="sd">            [([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;], &#39;\\r\\n使用条款和隐私条款。版权所有，保留一切权利。\\r\\n赞助商：&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;], &#39;。\\r\\n蒙ICP备06004630号\\r\\n&#39;)]</span>
<span class="sd">            [([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;], &#39;\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;], &#39;\\r\\n&#39;)]</span>
<span class="sd">            [([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;, &#39;div&#39;], &#39;\\r\\n\\r\\n\\r\\n&#39;)]</span>
<span class="sd">            [([&#39;html&#39;, &#39;body&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;], &#39;\\r\\n&#39;), ([&#39;html&#39;, &#39;body&#39;], &#39;\\r\\n\\r\\n&#39;)]</span>
<span class="sd">            [([&#39;html&#39;], &#39;\\r\\n&#39;), ([&#39;html&#39;], &#39;\\r\\n\\r\\n&#39;), ([&#39;html&#39;], &#39;\\r\\n\\r\\n&#39;)]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            utils.parr(dfs.attribs[-5:])</span>
<span class="sd">            {&#39;id&#39;: &#39;p2&#39;}</span>
<span class="sd">            {&#39;id&#39;: &#39;footer&#39;}</span>
<span class="sd">            {&#39;id&#39;: &#39;wrapper&#39;}</span>
<span class="sd">            {&#39;class&#39;: &#39;html&#39;}</span>
<span class="sd">            {&#39;lang&#39;: &#39;zh-cn&#39;}</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            dfs = engine.DFS(full_attrib=True)</span>
<span class="sd">            lxml.sax.saxify(root, dfs)</span>
<span class="sd">            utils.parr(dfs.attribs[-5:])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            [(&#39;lang&#39;, &#39;zh-cn&#39;), (&#39;class&#39;, &#39;html&#39;), (&#39;id&#39;, &#39;wrapper&#39;), (&#39;id&#39;, &#39;footer&#39;), (&#39;id&#39;, &#39;p2&#39;)]</span>
<span class="sd">            [(&#39;lang&#39;, &#39;zh-cn&#39;), (&#39;class&#39;, &#39;html&#39;), (&#39;id&#39;, &#39;wrapper&#39;), (&#39;id&#39;, &#39;footer&#39;)]</span>
<span class="sd">            [(&#39;lang&#39;, &#39;zh-cn&#39;), (&#39;class&#39;, &#39;html&#39;), (&#39;id&#39;, &#39;wrapper&#39;)]</span>
<span class="sd">            [(&#39;lang&#39;, &#39;zh-cn&#39;), (&#39;class&#39;, &#39;html&#39;)]</span>
<span class="sd">            [(&#39;lang&#39;, &#39;zh-cn&#39;)]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="DFS.attrl2tl"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.DFS.attrl2tl">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">attrl2tl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">attrl</span><span class="p">):</span>
        <span class="n">tl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attrl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attrl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">tl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span></div>
<div class="viewcode-block" id="DFS.attrl2dl"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.DFS.attrl2dl">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">attrl2dl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">attrl</span><span class="p">):</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attrl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attrl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dl</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">d</span><span class="p">[</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;attrib_pl&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrib_pl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;attrib_pl&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrib_pl</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currpl</span> <span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currattribl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texts_inseq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">({})</span>
<div class="viewcode-block" id="DFS.startElementNS"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.DFS.startElementNS">[docs]</a>    <span class="k">def</span> <span class="nf">startElementNS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">qname</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currattribl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>
<div class="viewcode-block" id="DFS.endElementNS"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.DFS.endElementNS">[docs]</a>    <span class="k">def</span> <span class="nf">endElementNS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">,</span> <span class="n">qname</span><span class="p">):</span>
        <span class="c1">#####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">qname</span><span class="p">)</span>
        <span class="c1">#####</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">index_last</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span><span class="p">[(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">):])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span><span class="p">[:</span><span class="n">index</span><span class="p">])</span>
        <span class="c1">#####</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#####</span>
        <span class="n">attribl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currattribl</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrib_pl</span><span class="p">):</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrl2tl</span><span class="p">(</span><span class="n">attribl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrl2dl</span><span class="p">(</span><span class="n">attribl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currattribl</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>
        <span class="c1">#####</span>
<div class="viewcode-block" id="DFS.characters"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.DFS.characters">[docs]</a>    <span class="k">def</span> <span class="nf">characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currdatal</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pl</span><span class="p">,</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texts_inseq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pl</span><span class="p">,</span><span class="n">data</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="dfs_traverse"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.dfs_traverse">[docs]</a><span class="k">def</span> <span class="nf">dfs_traverse</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Same as class DFS ,just return the object(include .pls , .attribs ,.datas, .texts_inseq, .tags......)</span>
<span class="sd">        | using default_wfs_handler</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rslt</span> <span class="o">=</span> <span class="n">DFS</span><span class="p">()</span>
    <span class="n">lxml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">saxify</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">rslt</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span></div>

<div class="viewcode-block" id="dfspls"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.dfspls">[docs]</a><span class="k">def</span> <span class="nf">dfspls</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | pathlist-sequence of  depth-first-traverse  </span>
<span class="sd">          </span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :return list:</span>
<span class="sd">            list of pathlists  in depth-first-traverse-sequence</span>
<span class="sd">    </span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">        root = LXHTML(html_str)</span>
<span class="sd">        pls = engine.dfspls(root)</span>
<span class="sd">        utils.parr(pls[:10])</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;script&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;script&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;meta&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;link&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;link&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;link&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;link&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;head&#39;, &#39;link&#39;]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        utils.parr(pls[-10:])</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;, &#39;script&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;div&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;, &#39;a&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;, &#39;p&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;, &#39;div&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;, &#39;div&#39;]</span>
<span class="sd">        [&#39;html&#39;, &#39;body&#39;]</span>
<span class="sd">        [&#39;html&#39;]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">dfs_traverse</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">pls</span><span class="p">)</span></div>
<span class="c1">#</span>



<div class="viewcode-block" id="BEAUTIFY"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY">[docs]</a><span class="k">class</span> <span class="nc">BEAUTIFY</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">):</span>
<div class="viewcode-block" id="BEAUTIFY.indent"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.indent">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;fixed_indent&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">fixed_indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fixed_indent&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fixed_indent</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span><span class="p">(</span><span class="n">fixed_indent</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">&quot;tab_width&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="n">tab_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab_width&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tab_width</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x20</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">tab_width</span> <span class="o">*</span> <span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">reduce_left</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span><span class="k">lambda</span> <span class="n">lngth</span><span class="p">,</span><span class="n">ele</span><span class="p">:(</span><span class="n">lngth</span><span class="o">+</span><span class="n">ele</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()),</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x20</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">sc</span>
        <span class="k">return</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.attr2tl"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.attr2tl">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">attr2tl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">attrl</span><span class="p">):</span>
        <span class="n">tl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attrl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attrl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">tl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.attrt2s"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.attrt2s">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">attrt2s</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;=&quot;&#39;</span><span class="o">+</span><span class="n">v</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.attrtl2str"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.attrtl2str">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">attrtl2str</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">tl</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span><span class="bp">cls</span><span class="o">.</span><span class="n">attrt2s</span><span class="p">,[])</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\x20</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.creat_start_tag_str"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.creat_start_tag_str">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">creat_start_tag_str</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">tlattr</span><span class="p">,</span><span class="n">padding</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span><span class="o">+</span><span class="n">tag</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\x20</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">attrtl2str</span><span class="p">(</span><span class="n">tlattr</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x20</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span><span class="s2">&quot;&gt;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">padding</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.creat_end_tag_str"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.creat_end_tag_str">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">creat_end_tag_str</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">padding</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&lt;/&quot;</span><span class="o">+</span><span class="n">tag</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">padding</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.creat_text_node_str"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.creat_text_node_str">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">creat_text_node_str</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">padding</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="k">lambda</span> <span class="n">ele</span><span class="p">:(</span><span class="n">padding</span><span class="o">+</span><span class="n">ele</span><span class="p">),[])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">elel</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currpl</span> <span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;highlight&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="p">{}</span>
<div class="viewcode-block" id="BEAUTIFY.startElementNS"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.startElementNS">[docs]</a>    <span class="k">def</span> <span class="nf">startElementNS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">qname</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="n">tlattr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr2tl</span><span class="p">(</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">creat_start_tag_str</span><span class="p">(</span><span class="n">qname</span><span class="p">,</span><span class="n">tlattr</span><span class="p">,</span><span class="n">padding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qname</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.endElementNS"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.endElementNS">[docs]</a>    <span class="k">def</span> <span class="nf">endElementNS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">,</span> <span class="n">qname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">creat_end_tag_str</span><span class="p">(</span><span class="n">qname</span><span class="p">,</span><span class="n">padding</span><span class="p">)</span></div>
<div class="viewcode-block" id="BEAUTIFY.characters"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.BEAUTIFY.characters">[docs]</a>    <span class="k">def</span> <span class="nf">characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currpl</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x20</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creat_text_node_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">padding</span><span class="p">)</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(.*</span><span class="se">\n</span><span class="s2">)([</span><span class="se">\x20</span><span class="s2">]*?)&quot;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">+</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="beautify"><a class="viewcode-back" href="../../nvhtml.html#nvhtml.engine.beautify">[docs]</a><span class="k">def</span> <span class="nf">beautify</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        | Beautity html output</span>
<span class="sd">        </span>
<span class="sd">        :param  lxml.etree._Element root: </span>
<span class="sd">            lxml-etree-element</span>
<span class="sd">        :param  bool kwargs[&quot;fixed_indent]&quot;: </span>
<span class="sd">            default True</span>
<span class="sd">            fixed_indent, if False ,indent based on tag-string-width</span>
<span class="sd">        :param  in tab_width: </span>
<span class="sd">            default 4</span>
<span class="sd">            used for fixed_indent</span>
<span class="sd">        :return str:</span>
<span class="sd">            beautified html_str</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            html_str = fs.rfile(&quot;./test.html&quot;)</span>
<span class="sd">            root = LXHTML(html_str)</span>
<span class="sd">            html_str = engine.beautify(root)</span>
<span class="sd">            print(html_str[:480])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &lt;html lang=&quot;zh-cn&quot;&gt;</span>
<span class="sd">                &lt;head&gt;</span>
<span class="sd">                    &lt;script async=&quot;&quot; src=&quot;https://www.googletagmanager.com/gtag/js?id=UA-878633-1&quot;&gt;</span>
<span class="sd">                    &lt;/script&gt;</span>
<span class="sd">                    &lt;script&gt;</span>
<span class="sd">                        window.dataLayer = window.dataLayer || [];</span>
<span class="sd">                    &lt;/script&gt;</span>
<span class="sd">                    &lt;meta charset=&quot;gbk&quot;&gt;</span>
<span class="sd">                    &lt;/meta&gt;</span>
<span class="sd">                    &lt;meta name=&quot;robots&quot; content=&quot;all&quot;&gt;</span>
<span class="sd">                    &lt;/meta&gt;</span>
<span class="sd">                    &lt;meta name=&quot;author&quot; content=&quot;w3school.com.cn&quot;&gt;</span>
<span class="sd">                    &lt;/meta&gt;</span>
<span class="sd">                    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/c5_20171220.css&quot;&gt;</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            html_str = engine.beautify(root,fixed_indent=False)</span>
<span class="sd">            print(html_str[:480])</span>
<span class="sd">            print(html_str[:550])</span>
<span class="sd">            &lt;html lang=&quot;zh-cn&quot;&gt;</span>
<span class="sd">                  &lt;head&gt;</span>
<span class="sd">                        &lt;script async=&quot;&quot; src=&quot;https://www.googletagmanager.com/gtag/js?id=UA-878633-1&quot;&gt;</span>
<span class="sd">                        &lt;/script&gt;</span>
<span class="sd">                        &lt;script&gt;</span>
<span class="sd">                                window.dataLayer = window.dataLayer || [];</span>
<span class="sd">                        &lt;/script&gt;</span>
<span class="sd">                        &lt;meta charset=&quot;gbk&quot;&gt;</span>
<span class="sd">                        &lt;/meta&gt;</span>
<span class="sd">                        &lt;meta name=&quot;robots&quot; content=&quot;all&quot;&gt;</span>
<span class="sd">                        &lt;/meta&gt;</span>
<span class="sd">                        &lt;meta name=&quot;author&quot; content=&quot;w3school.com.cn&quot;&gt;</span>
<span class="sd">                        &lt;/meta&gt;</span>
<span class="sd">                        &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/c5_20171220.css&quot;&gt;</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">BEAUTIFY</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">lxml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">saxify</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">nvhtml</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">nvhtml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">nvhtml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">TODO</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, dli.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>